# Bradax SDK - Interface LangChain Corporativa

> **SDK Python com interface LangChain-compat√≠vel para integra√ß√£o segura com o Bradax Broker. Governan√ßa empresarial integrada.**

## üéØ Interface Principal LangChain

O Bradax SDK agora oferece interface **100% compat√≠vel com LangChain** para m√°xima produtividade:

```python
from bradax import BradaxClient
from bradax.config import BradaxSDKConfig

# Configura√ß√£o corporativa
config = BradaxSDKConfig.for_production(
    broker_url="https://api.bradax.com",
    project_id="seu-projeto",
    api_key="sua-chave-api"
)

client = BradaxClient(config)

# Interface LangChain padr√£o - M√âTODO PRINCIPAL
response = client.invoke("Analise este relat√≥rio financeiro")
print(response["content"])

# Interface ass√≠ncrona LangChain
response = await client.ainvoke("Gere resumo executivo") 
print(response["content"])
```

## üèóÔ∏è Configura√ß√µes por Ambiente

### üõ†Ô∏è Desenvolvimento (Recomendado para Desenvolvedores)
```python
# Para desenvolvimento local e testes
config = BradaxSDKConfig.for_development(
    broker_url="http://localhost:8000",    # Broker local
    project_id="dev-projeto",
    enable_telemetry=False,               # Reduz overhead
    enable_guardrails=False,              # Mais flex√≠vel
    timeout=30
)
```

### üß™ Testes Unit√°rios
```python
# Para testes automatizados
config = BradaxSDKConfig.for_testing(
    project_id="test-projeto",
    enable_telemetry=False,
    enable_guardrails=False
)
```

### ‚ö†Ô∏è Produ√ß√£o (Uso Interno - Deploy Autom√°tico)
```python
# ATEN√á√ÉO: Esta configura√ß√£o √© usada apenas pela esteira de CI/CD
# Desenvolvedores N√ÉO devem usar esta configura√ß√£o diretamente
# Testes em produ√ß√£o s√£o executados pelo sistema de deploy
config = BradaxSDKConfig.for_production(
    broker_url="https://api.bradax.com",  # HTTPS obrigat√≥rio
    project_id="projeto-prod",
    api_key="prod-api-key",              # Obrigat√≥rio
    enable_telemetry=True,
    enable_guardrails=True,
    timeout=60
```

## üì¶ Instala√ß√£o R√°pida

```bash
pip install bradax-sdk
```

## üöÄ Configura√ß√£o Avan√ßada

### Guardrails Personalizados
```python
from bradax import BradaxClient
from bradax.config import BradaxSDKConfig

# Configura√ß√£o para desenvolvimento com guardrails customizados
config = BradaxSDKConfig.for_development(
    broker_url="http://localhost:8000",
    project_id="projeto-com-guardrails",
    enable_guardrails=True
)

client = BradaxClient(config)

# Adicionar regras de guardrail personalizadas
client.add_custom_guardrail_rule({
    "id": "content_safety",
    "pattern": "senha|cpf|cart√£o",
    "severity": "HIGH"
})
```

## üõ°Ô∏è Guardrails Personalizados

### Conceito Fundamental
- **Guardrails do Projeto:** Obrigat√≥rios, definidos no broker (N√ÉO podem ser desabilitados)
- **Guardrails Personalizados:** Opcionais, adicionados pelo SDK (COMPLEMENTAM os defaults)

### Adicionar Guardrails Locais
```python
# Guardrail de seguran√ßa de dados
client.add_custom_guardrail_rule({
    "id": "data_security",
    "pattern": "confidencial|secreto|interno",
    "severity": "CRITICAL"
})

# Guardrail de compliance
client.add_custom_guardrail_rule({
    "id": "compliance_check", 
    "pattern": "dados pessoais|informa√ß√£o privada",
    "severity": "HIGH"
})

# Guardrail de qualidade de entrada
client.add_custom_guardrail_rule({
    "id": "input_quality",
    "pattern": "^.{0,5}$",  # Texto muito curto
    "severity": "MEDIUM"
})

# Verificar se conte√∫do passa pelos guardrails
is_valid = client.validate_content("Este texto est√° seguro para processamento")
print(f"Conte√∫do v√°lido: {is_valid}")
```

## üìä Uso LangChain-Compatible

### Exemplos Pr√°ticos com invoke()
```python
# Exemplo 1: String simples
response = client.invoke("Resuma este documento em 3 pontos principais")
print(response["content"])

# Exemplo 2: Lista de mensagens (formato LangChain)
messages = [
    {"role": "system", "content": "Voc√™ √© um assistente especializado em an√°lise de dados"},
    {"role": "user", "content": "Analise estas vendas: Q1: 100k, Q2: 120k, Q3: 95k"}
]
response = client.invoke(messages)
print(response["content"])

# Exemplo 3: Configura√ß√£o avan√ßada
response = client.invoke(
    "Explique machine learning",
    config={"model": "gpt-4", "temperature": 0.1},
    max_tokens=500
)
print(f"Modelo usado: {response['response_metadata']['model']}")

# Exemplo 4: Uso ass√≠ncrono
async def process_document(document_text):
    response = await client.ainvoke([
        {"role": "user", "content": f"Analise este documento: {document_text}"}
    ])
    return response["content"]
```

### Verifica√ß√£o de Sa√∫de e Status
```python
# Verificar se broker est√° dispon√≠vel
try:
    health = client.check_broker_health()
    print(f"Broker status: {health['status']}")
except Exception as e:
    print(f"Broker indispon√≠vel: {e}")
```

## üîß Configura√ß√£o Centralizada

### Configura√ß√£o por Ambiente
```python
from bradax.config import BradaxSDKConfig

# Configura√ß√£o autom√°tica baseada no ambiente
config = BradaxSDKConfig.from_environment()

# Configura√ß√£o para testes
test_config = BradaxSDKConfig.for_testing()

# Configura√ß√£o manual
config = BradaxSDKConfig(
    broker_url="https://llm.empresa.com",
    timeout=30,
    api_key_prefix="bradax_",
    environment="production",
    debug=False,
    custom_guardrails={},
    local_telemetry_enabled=True,
    telemetry_buffer_size=100
)
```

### Vari√°veis de Ambiente Suportadas
```bash
# URLs e conectividade
BRADAX_BROKER_URL=https://llm.empresa.com
BRADAX_TIMEOUT=30

# Configura√ß√£o de ambiente
BRADAX_ENVIRONMENT=production
BRADAX_DEBUG=false

# Telemetria local
BRADAX_LOCAL_TELEMETRY=true
BRADAX_TELEMETRY_BUFFER=100
```

## üé≠ Opera√ß√µes Avan√ßadas

### Context Manager
```python
# Uso com context manager (recomendado)
with BradaxClient("proj_token_123") as client:
    response = client.run_llm(
        prompt="Gere um resumo executivo...",
        model="gpt-4o-mini"
    )
    print(response["content"])
# Cliente √© automaticamente fechado
```

### Opera√ß√µes Batch
```python
# Processar m√∫ltiplas requisi√ß√µes
prompts = [
    "Analise documento 1",
    "Analise documento 2", 
    "Analise documento 3"
]

results = []
for prompt in prompts:
    response = client.run_llm(
        prompt=prompt,
        model="gpt-4o-mini",
        max_tokens=500
    )
    results.append(response)
```

### Streaming (quando suportado)
```python
# Stream de resposta em tempo real
for chunk in client.stream_llm(
    prompt="Escreva um relat√≥rio detalhado sobre...",
    model="gpt-4o",
    max_tokens=2000
):
    print(chunk, end="", flush=True)
```

## üîí Seguran√ßa e Autentica√ß√£o

### Tokens de Projeto
```python
# Token de projeto corporativo (formato padr√£o)
project_token = "proj_acme_2025_ai_assistant_001"
#                ^^^^_^^^^_^^^^_^^^^^^^^^^^^_^^^
#                proj_org_year_project_name_seq

# Valida√ß√£o autom√°tica de formato
client = BradaxClient(project_token)  # Valida automaticamente
```

### Headers Autom√°ticos
```python
# Headers adicionados automaticamente pelo SDK
{
    "Authorization": "Bearer proj_acme_2025_ai_assistant_001",
    "X-Project-Token": "proj_acme_2025_ai_assistant_001",
    "Content-Type": "application/json",
    "User-Agent": "bradax-sdk/1.0.0 (env:production)"
}
```

## üìã Tratamento de Erros

### Hierarquia de Exce√ß√µes
```python
from bradax.exceptions import (
    BradaxError,                  # Base exception
    BradaxAuthenticationError,    # Token inv√°lido/expirado
    BradaxConnectionError,        # Problemas de rede
    BradaxConfigurationError,     # Configura√ß√£o inv√°lida
    BradaxValidationError,        # Dados de entrada inv√°lidos
    BradaxBrokerError            # Erros do broker
)

try:
    response = client.run_llm(
        prompt="Analise estes dados...",
        model="modelo-inexistente"
    )
except BradaxValidationError as e:
    print(f"Dados inv√°lidos: {e}")
except BradaxAuthenticationError as e:
    print(f"Problema de autentica√ß√£o: {e}")
except BradaxBrokerError as e:
    print(f"Erro do broker: {e}")
except BradaxError as e:
    print(f"Erro geral: {e}")
```

### Tratamento Espec√≠fico
```python
# Retry autom√°tico para erros de rede
client = BradaxClient(
    project_token="proj_token_123",
    max_retries=3  # Tentar√° at√© 3 vezes em caso de falha de rede
)

# Logs detalhados para debug
client = BradaxClient(
    project_token="proj_token_123",
    verbose=True  # Ativa logs detalhados
)
```

## üèóÔ∏è Integra√ß√£o Corporativa

### Padr√£o Factory
```python
from bradax import create_client_for_project

# Factory method para projetos corporativos
client = create_client_for_project(
    project_name="ai_assistant",
    organization="acme",
    year=2025,
    environment="production"
)
# Gera automaticamente: proj_acme_2025_ai_assistant_001
```

### Configura√ß√£o de Projeto
```python
from bradax.config import ProjectConfig

# Configura√ß√£o espec√≠fica do projeto
project_config = ProjectConfig(
    project_id="proj_acme_2025_ai_assistant_001",
    api_key="bradax_secret_key_here",
    organization="ACME Corp",
    department="TI",
    budget_limit=5000.00,
    allowed_models=["gpt-4o-mini", "gpt-3.5-turbo"]
)

# Cliente com configura√ß√£o de projeto
client = BradaxClient(
    project_token=project_config.api_key,
    project_config=project_config
)
```

## üìä Monitoramento e Debug

### Health Check
```python
# Verificar status do broker
health = client.get_health()
print(f"Status: {health['status']}")
print(f"Servi√ßos: {health['services']}")
```

### Logs e Debug
```python
import logging

# Configurar logging do SDK
logging.getLogger("bradax").setLevel(logging.DEBUG)

# Cliente com debug ativo
client = BradaxClient(
    project_token="proj_token_123",
    verbose=True
)

# Logs autom√°ticos incluem:
# - Requisi√ß√µes enviadas
# - Respostas recebidas
# - Guardrails acionados
# - M√©tricas de performance
```

### M√©tricas Locais
```python
# Coletar m√©tricas da sess√£o atual
metrics = client.get_session_metrics()
print(f"Requisi√ß√µes: {metrics['total_requests']}")
print(f"Tempo total: {metrics['total_time_ms']}ms")
print(f"Guardrails acionados: {metrics['guardrails_triggered']}")
```

## üîÑ Casos de Uso Reais

### 1. An√°lise de Documentos
```python
def analyze_document(file_path: str) -> dict:
    with open(file_path, 'r') as f:
        content = f.read()
    
    with BradaxClient("proj_acme_2025_document_analyzer_001") as client:
        # Adicionar guardrail espec√≠fico para documentos
        client.add_custom_guardrail("document_validation", {
            "max_size_mb": 10,
            "allowed_formats": ["txt", "md", "docx"],
            "require_content": True
        })
        
        response = client.run_llm(
            prompt=f"Analise este documento e forne√ßa um resumo: {content}",
            model="gpt-4o-mini",
            max_tokens=1000
        )
        
        return {
            "summary": response["content"],
            "word_count": len(content.split()),
            "analysis_tokens": response.get("usage", {}).get("total_tokens", 0)
        }
```

### 2. Chatbot Corporativo
```python
class CorporateChatbot:
    def __init__(self, project_token: str):
        self.client = BradaxClient(project_token)
        
        # Configurar guardrails para chat
        self.client.add_custom_guardrail("chat_safety", {
            "max_message_length": 2000,
            "require_politeness": True,
            "corporate_context": True
        })
    
    def chat(self, user_message: str, context: str = "") -> str:
        prompt = f"""
        Contexto corporativo: {context}
        Pergunta do usu√°rio: {user_message}
        
        Responda de forma profissional e precisa.
        """
        
        response = self.client.run_llm(
            prompt=prompt,
            model="gpt-4o-mini",
            max_tokens=500,
            temperature=0.7
        )
        
        return response["content"]
```

### 3. Processamento em Lote
```python
def process_customer_feedback(feedback_list: list) -> dict:
    results = {
        "positive": [],
        "negative": [],
        "neutral": [],
        "total_processed": 0
    }
    
    with BradaxClient("proj_acme_2025_feedback_analyzer_001") as client:
        for feedback in feedback_list:
            try:
                response = client.run_llm(
                    prompt=f"Classifique este feedback como positivo, negativo ou neutro: {feedback}",
                    model="gpt-3.5-turbo",
                    max_tokens=50
                )
                
                sentiment = response["content"].lower().strip()
                if "positivo" in sentiment:
                    results["positive"].append(feedback)
                elif "negativo" in sentiment:
                    results["negative"].append(feedback)
                else:
                    results["neutral"].append(feedback)
                    
                results["total_processed"] += 1
                
            except Exception as e:
                print(f"Erro processando feedback: {e}")
    
    return results
```

## üè¢ Conformidade Corporativa

### Pr√°ticas Recomendadas
1. **Sempre usar context managers** para garantir fechamento de recursos
2. **Configurar guardrails apropriados** para cada caso de uso
3. **Monitorar telemetria local** para otimiza√ß√£o
4. **Tratar exce√ß√µes espec√≠ficas** para melhor experi√™ncia
5. **Usar configura√ß√£o centralizada** para ambientes

### Auditoria e Compliance
```python
# Todas as opera√ß√µes s√£o automaticamente auditadas
# Dados incluem:
# - Timestamp da requisi√ß√£o
# - Token do projeto usado
# - Modelo e par√¢metros
# - Conte√∫do (se configurado)
# - Guardrails acionados
# - M√©tricas de performance
```

---

> **üíº Nota Corporativa:** Este SDK foi projetado para ambientes empresariais que exigem controle total, auditoria completa e conformidade com pol√≠ticas corporativas. Todas as opera√ß√µes s√£o transparentes e audit√°veis.
